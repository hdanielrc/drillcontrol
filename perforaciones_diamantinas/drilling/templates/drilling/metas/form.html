{% extends 'drilling/base.html' %}
{% load static %}

{% block title %}{% if is_edit %}Editar Meta{% else %}Nueva Meta{% endif %}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-bullseye"></i> 
                        {% if is_edit %}Editar Meta de M치quina{% else %}Nueva Meta de M치quina{% endif %}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Informaci칩n General -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="contrato" class="form-label required">Contrato</label>
                                <select name="contrato" id="contrato" class="form-select" required>
                                    <option value="">Seleccione un contrato</option>
                                    {% for contrato in contratos %}
                                        <option value="{{ contrato.id }}" 
                                                {% if is_edit and meta.contrato_id == contrato.id %}selected{% endif %}>
                                            {{ contrato.nombre_contrato }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="maquina" class="form-label required">M치quina</label>
                                <select name="maquina" id="maquina" class="form-select" required>
                                    <option value="">Seleccione una m치quina</option>
                                    {% for maquina in maquinas %}
                                        <option value="{{ maquina.id }}" 
                                                {% if is_edit and meta.maquina_id == maquina.id %}selected{% endif %}>
                                            {{ maquina.nombre }} ({{ maquina.tipo }})
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Per칤odo Est치ndar (Mes Operativo) -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">游늱 Mes Operativo (26-25)</h6>
                                <small class="text-muted">El per칤odo ir치 del d칤a 26 del mes anterior al 25 del mes seleccionado</small>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="a침o" class="form-label required">A침o</label>
                                        <select name="a침o" id="a침o" class="form-select" required>
                                            {% for a침o_item in a침os_disponibles %}
                                                <option value="{{ a침o_item }}" 
                                                        {% if is_edit and meta.a침o == a침o_item %}selected{% endif %}>
                                                    {{ a침o_item }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="mes" class="form-label required">Mes Operativo</label>
                                        <select name="mes" id="mes" class="form-select" required>
                                            {% for mes_num, mes_nombre in meses %}
                                                <option value="{{ mes_num }}" 
                                                        {% if is_edit and meta.mes == mes_num %}selected{% endif %}>
                                                    {{ mes_nombre }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Per칤odo Personalizado (Opcional) -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">游늰 Per칤odo Personalizado (Opcional)</h6>
                                <small class="text-muted">Complete solo si necesita un per칤odo diferente al mes operativo est치ndar</small>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="fecha_inicio" class="form-label">Fecha Inicio</label>
                                        <input type="date" 
                                               name="fecha_inicio" 
                                               id="fecha_inicio" 
                                               class="form-control"
                                               {% if is_edit and meta.fecha_inicio %}value="{{ meta.fecha_inicio|date:'Y-m-d' }}"{% endif %}>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <label for="fecha_fin" class="form-label">Fecha Fin</label>
                                        <input type="date" 
                                               name="fecha_fin" 
                                               id="fecha_fin" 
                                               class="form-control"
                                               {% if is_edit and meta.fecha_fin %}value="{{ meta.fecha_fin|date:'Y-m-d' }}"{% endif %}>
                                    </div>
                                </div>
                                <div class="alert alert-info mt-3 mb-0">
                                    <i class="fas fa-info-circle"></i> 
                                    <strong>Nota:</strong> Si completa las fechas personalizadas, el sistema usar치 estas fechas en lugar del mes operativo.
                                </div>
                            </div>
                        </div>

                        <!-- Meta -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="meta_metros" class="form-label required">Meta en Metros</label>
                                <input type="number" 
                                       name="meta_metros" 
                                       id="meta_metros" 
                                       class="form-control" 
                                       step="0.01" 
                                       min="0.01"
                                       {% if is_edit %}value="{{ meta.meta_metros }}"{% endif %}
                                       required>
                                <small class="text-muted">Metraje objetivo para el per칤odo</small>
                            </div>
                            
                            {% if is_edit %}
                            <div class="col-md-6">
                                <label for="activo" class="form-label">Estado</label>
                                <select name="activo" id="activo" class="form-select">
                                    <option value="1" {% if meta.activo %}selected{% endif %}>Activa</option>
                                    <option value="0" {% if not meta.activo %}selected{% endif %}>Inactiva</option>
                                </select>
                            </div>
                            {% endif %}
                        </div>

                        <!-- Observaciones -->
                        <div class="mb-4">
                            <label for="observaciones" class="form-label">Observaciones</label>
                            <textarea name="observaciones" 
                                      id="observaciones" 
                                      class="form-control" 
                                      rows="3"
                                      placeholder="Notas adicionales sobre la meta (ej: 'Meta ajustada por mantenimiento programado')">{% if is_edit %}{{ meta.observaciones }}{% endif %}</textarea>
                        </div>

                        <!-- Botones -->
                        <div class="d-flex justify-content-end gap-2">
                            <a href="{% url 'metas-maquina-list' %}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> 
                                {% if is_edit %}Actualizar Meta{% else %}Crear Meta{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.required:after {
    content: " *";
    color: red;
}
</style>
{% endblock %}
